name: Convert DynamicWorld Model

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  convert-dynamicworld:
    runs-on: ubuntu-latest

    steps:
      # Checkout repository
      - name: Checkout repository
        uses: actions/checkout@v3

      # Setup Python (fixed version)
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: 3.10  # <-- changed from 3.1 to 3.10

      # Install dependencies
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install tensorflow==2.13.1 tensorflowjs==3.18.0 tensorflow-hub==0.12.0 protobuf==3.20.3

      # Make sure models folder exists
      - name: Create models folder
        run: mkdir -p ./models/dynamicworld

      # Copy DynamicWorld saved_model from repo to models folder
      - name: Copy DynamicWorld SavedModel
        run: cp -r ./dynamicworld/saved_model ./models/dynamicworld

      # Convert the DynamicWorld SavedModel to TensorFlow.js format
      - name: Convert DynamicWorld model to TFJS
        run: |
          echo "Converting DynamicWorld model..."
          tensorflowjs_converter \
            --input_format=tf_saved_model \
            --output_format=tfjs_graph_model \
            --signature_name=serving_default \
            ./models/dynamicworld \
            ./models/dynamicworld/tfjs
