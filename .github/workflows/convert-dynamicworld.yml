name: Convert DynamicWorld TF Model to TFJS

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  convert_dynamicworld:
    runs-on: ubuntu-latest

    env:
      DYNAMICWORLD_MODEL_PATH: ./models/dynamicworld  # Path to your downloaded DynamicWorld SavedModel
      TFJS_OUTPUT_PATH: ./tfjs_models/dynamicworld   # Output folder for converted TFJS model

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Pull TensorFlow Docker image
        run: docker pull tensorflow/tensorflow:2.12.0

      - name: Convert DynamicWorld model to TFJS
        run: |
          docker run --rm -v $GITHUB_WORKSPACE:/workspace -w /workspace tensorflow/tensorflow:2.12.0 bash -c "\
            pip install --upgrade pip && \
            pip install 'numpy<2' tensorflowjs==3.18.0 protobuf==3.20.3 && \
            echo 'Converting DynamicWorld model...' && \
            tensorflowjs_converter \
              --input_format=tf_saved_model \
              --signature_name=serving_default \
              --saved_model_tags=serve \
              $DYNAMICWORLD_MODEL_PATH \
              $TFJS_OUTPUT_PATH"
